#!/bin/bash

if [ -z $1 ]; then
  echo "dsky SUBJECT VERB"
  exit 0
fi

if [ $1 == '.' ]; then
    NOUN=`pwd | rev | cut -d'/' -f1 |rev`
else
    NOUN=$1
fi

PROJ_DIR="$PROJECTS/$NOUN"

if [ -d $PROJ_DIR ]; then
  cd /tmp
  mkdir -p dsky
  cd dsky

  if [ -d $NOUN ]; then
    echo 'project cached'
  else 
    git clone $PROJ_DIR
  fi

  cd $NOUN

  # TODO need to be able to specify if PROJECT dir, or temp dir
  case "$2" in
  github )
      cd $PROJ_DIR
      # open or xdg-open
      open "http://github.com/`cat .git/config | grep url | cut -d: -f2 | cut -d. -f1`"
      ;;
  stat )
      cd $PROJ_DIR
      # tc build 
      # github prs
      git diff
      git diff --stat
      echo "pull requests"
      dsky $1 pr
      ;;
  pr )
      cd $PROJ_DIR
      hub pr list -s open -L 10 --format="%l%i %au: %t %uI %Nc%n    a:%as  r:%rs  %L%n" # %sC for color
      ;;
  prc )
      cd $PROJ_DIR
      hub pr checkout $3
      ;;
  edit )
      cd $PROJ_DIR
      $EDITOR
      ;;
  vi )
      cd $PROJ_DIR
      vi
      ;;
  commit )
      cd $PROJ_DIR
      git add .
      git commit
      ;;
  push )
      cd $PROJ_DIR
      git push origin
      ;;
  stash )
      cd $PROJ_DIR
      git stash
      ;;
  rebase )
      cd $PROJ_DIR
      git pull --rebase origin master
      ;;
  co )
      git checkout $3
      ;;
  branch )
      git branch -a
      ;;
  idea )
      cd $PROJ_DIR
      idea $1
      ;;
  run )
      docker run -P $1
      ;;
  * )
      cd $PROJ_DIR
      make $3
      ;;
  esac

else 
  # not a local ~/project 
  echo "SUBJECT $NOUN not found."
fi

